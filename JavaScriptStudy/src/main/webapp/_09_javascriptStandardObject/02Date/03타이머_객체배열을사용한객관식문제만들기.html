<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>타이머_객체배열을 사용한 객관식문제 만들기</title>

<style type="text/css">

	div#timer {
		/* border: solid 1px gray; */
		padding: 30px 0 0 20px;
		color: blue;
		font-size: 20pt;
	}
	
	div#quiz_display {
		margin-top: 30px;
		padding-left: 20px;
		
	}
	
	li {
		line-height: 30px;	/* 줄간격 */
	}
	
	div.ox {
		font-size: 10pt;
		font-weight: bold;
		padding-bottom: 20px;
		margin-top: -10px; 
	}

</style>

<script type="text/javascript">

	window.onload = function() {
		
		const timerDiv = document.querySelector("div#timer");	// 타이머를 보여줄 장소
		
		let time = 600; 	// 타이머 시간을 10분으로 지정함. (600초)
		
		// 타이머 함수 만들기
		const timer = function() {	// function timer() {} 와 같다.
			
			let minute = "";
			let second = "";
			
			minute =  parseInt (time / 60);	// 소수부는 없애고 정수만 가져오는 것이다.
			if(minute < 10) {
				minute = "0" + minute;
			}
			
			second = parseInt( time % 60 );
			if(second < 10) {
				second = "0" + second;
			}
			
			const html = `${minute}:${second}`;
			timerDiv.innerHTML = html;
			
			time--;
			if(time < 0) {
				alert("시험시간 종료!!\n자동으로 제출됩니다.")
				
				clearInterval(setTimer);	// 타이머 삭제하기.
											// setTimer 는 중단해야할 setInterval 함수를 가리키는 것이다.				
				btnSubmit.disabled = true;	// 제출이 완료되면 "제출하기" 버튼을 비활성화 해야한다.
				// 채점하는 함수 호출 (시간이 다 되면 자동으로 제출 되어야한다.)
			}
			
		};
		
		timer(); // 타이머 함수를 호출
		
	//	setInterval(function(){ timer(); }, 1000); // 1초마다 주기적으로 타이머 함수 호출하도록 지정.
	//	또는
		const setTimer = setInterval(timer , 1000); // 1초마다 주기적으로 타이머 함수 호출하도록 지정. (아래에서 재활용 할 것이므로 let)
													// setTimer 는 중단해야할 setInterval 함수를 가리키는 것이다.

													
		///////////////////////////////////////////////////////////////////////////////////////////////										
													
		const arr_quizData = [
			{
				question : "문제1. 대한민국의 수도는?", 
				answers  : {  
					1 : "부산",		// key값(속성명)
					2 : "서울",
					3 : "인천",
					4 : "수원"
				},
				correct : 2
			},
			{
				question : "문제2. 1+1은?", 
				answers  : {  
					1 : "10",		
					2 : "20",
					3 : "2",
					4 : "5"
				},
				correct : 3
			
			},
			{
				question : "문제3. 2022년에 올림픽이 열린 국가는?", 
				answers  : {  
					1 : "미국",		
					2 : "한국",
					3 : "중국",
					4 : "영국",
					5 : "이탈리아"
				},
				correct : 3
				
			}
		];											
		// 배열 객체로 만들기
		
		
		const quizDiv = document.querySelector("div#quiz_display");	// 퀴즈문항을 보여줄 장소											
													
		// 퀴즈문항을 html 로 만들기
		let html = ``;
		
		arr_quizData.forEach( (item, index) => {
			html += `<p id="q${index}">${item.question}</p>`;
			
			html += `<ol>`
			
			for(let key in item.answers) {		// 어떤 객체의 속성(키(여기서는 속성값 1,2,3,4..))들을 모두 불러올 때는 for 문에서 of 가 아니라, in 을 사용한다.
				html += `<li> ${item.answers[key]} <input type="radio" name="question${index}" value="${key}" /> </li>`;
												// name="question${index}" 은 각 인덱스별로 1개만 체크되도록 하기 위함.
												// 객체명.속성명 은 속성명에는 변수가 사용될 수 없다. (즉,item.answers.key 는 XX)
												// 객체명[속성명] 은 속성명에 변수가 사용될 수 있다.
												// ${item.answers[key]} 는 "부산"과 같은 것을 말하는 것이다.
												
												// 라디오는 반드시 name 값이 동일해야 한다.
												// value 값은 item.answers 의 속성명인 1 2 3 4 로 된다.				
			}
			
			html += `</ol>`;			
			html += `<div class='ox' id="ox${index}"></div>`;		// 퀴즈 문항에 대해 정답인지 오답인지 보여줄 장소
		} );
		
		quizDiv.innerHTML = html;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////
				
		// 제출하기 버튼 클릭시 이벤트 처리		
		const btnSubmit = document.querySelector("button#btnSubmit");	// 제출하기 버튼 이벤트 소스 
		
		const handleSubmit = function() {			
			if (confirm("정말로 제출 하시겠습니까?"))	{	// 제출 할건지 물어보자.
				alert("제출이 완료되었습니다.");			// 제출하기 버튼 -> 확인(true), 취소(false)
				clearInterval(setTimer);			// 제출이 완료되면 타이머를 삭제해야 한다.
				timerDiv.innerHTML = "00:00";		// 제출이 완료되면 0분 0초로 만들자.	
				btnSubmit.disabled = true;			// 제출이 완료되면 "제출하기" 버튼을 비활성화 해야한다.
			 // btnSubmit.disabled = false; 		// "제출하기" 버튼 활성화(enabled 가 아니다.)
				checkScore();						// 채점하는 함수 호출
			}
		};
		
		btnSubmit.addEventListener('click', handleSubmit);

		
		
		//////////////////////////////////////////////////////////////////////////////////////////////////
	
		// 채점하는 함수 만들기
		function checkScore() {
			
			let answerCount = 0;	// 정답갯수 누적용
			
			arr_quizData.forEach( (item, index) => {  
				
				console.log((index + 1)+"번 문제 정답은" + item.correct)	// 제출하면 정답을 보이겠다.
				// index 는 0 부터니까 +1 을 더해서 key 값 1,2,3... 을 맞춘다.
				
				// 퀴즈문항 뒤에 정답번호 공개하기
				document.querySelector("p#q"+index).append("  "+item.correct);	//" " 한칸 띄움.
				// 노드.append("문자열")는 노드 바로 뒤에 문자열을 덧붙여 주는 것이다.
				
				let radio_length = document.getElementsByName(`question${index}`).length; // $가 나왔으면 `` 을 써주면 된다.
				console.log((index + 1)+"번 문제 라디오 개수는" + radio_length)	// 제출하면 정답을 보이겠다.
				// 보기의 개수가 다 다를 수 있기 때문에 확인하기 위함. (라디오는 체크모양 표시)
					
				let isCheckAnswer = false;		// 라디오에 선택유무 검사용, 선택을 안했으면 틀림처리.
				for(let i=0; i<radio_length; i++) {
				 	if( document.getElementsByName(`question${index}`)[i].checked ) {
				 		isCheckAnswer = true;
				 		break;
				 	}
				}// end of for----------------------------------------
				console.log("답을 선택하셨나요? : " + isCheckAnswer);
				
				let userAnswer;		// let 는 나중에 값을 줘도 된다.
				if(isCheckAnswer == true) { // 답을 선택한경우 (라디오에 체크한 경우)
					userAnswer = document.querySelector(`input[name="question${index}"]:checked`).value;	// 라디오 type 의 input 태그인데 name 이 무엇인지?
					// user 가 선택한 값 (정답이 아닌 사용자가 선택한 것)
					// :checked 는 라디오중에 선택된(checked) 라디오를 말한다.
					// value : 보기 1~4 or 1~5 를 뜻함					
				}
				else {	// 답을 선택하지 않은경우 (라디오에 체크하지 않은 경우)
					userAnswer = "선택안함";
				}
				console.log("사용자가 선택한 답번호 : " + userAnswer);
				console.log("");
				
				if( userAnswer == item.correct ) {	// 유저가 선택한 값 == item.correct : 정답 (*== : 값만 같은지 판단)
					answerCount++;		// 맞은 갯수가 몇개인지?
					document.querySelector(`div#ox${index}`).innerHTML = "<span style='color:blue'>정답</span>";	// 해당 div의 html 에 적어준다.
				}
				else {
					document.querySelector(`div#ox${index}`).innerHTML = "<span style='color:red'>틀림</span>";	// 해당 div의 html 에 적어준다.
				}
				
			} );// end of arr_quizData.forEach( (item, index)------------------------------------
			
			document.querySelector("div#score").innerHTML = `<span style='font-weight:bold'>정답개수 : ${answerCount}</span>`;		
					
		}// end of function checkScore()------------------------------------
		
	}// end of window.onload = function()------------------------------------

</script>
</head>
<body>

		<div id="timer"></div>
		<div id="quiz_display"></div>
		
		<button type="button" id="btnSubmit" style="border: solid 1px tomato; color: tomato; padding: 5px; border-radius: 5px;">제출하기</button>
		<div id="score" style="margin-top: 10px;"></div>
	
</body>
</html>